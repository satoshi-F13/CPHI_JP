---
title: "CPHI Japan Exhibition Analysis Dashboard"
subtitle: "Comprehensive Analysis of Asia's Leading Pharmaceutical Event (2023-2025)"
# author: "SATOM OÃœ - Exhibition Analytics"
date: today
format:
  dashboard:
    theme: 
      light: 
        - default
        - custom.scss
    fillPage: true
    logo: logos/wide/satom-wide-color.png
    nav-buttons:
      - icon: globe
        href: https://www.cphi.com/japan/en/home.html
    fig-width: 10
    fig-height: 6
    embed-resources: true
editor: visual
execute:
  warning: false
  message: false
  echo: false
---

```{r setup, include=FALSE}
# Load required libraries
library(tidyverse)
library(DT)
library(plotly)
library(scales)
library(knitr)
library(kableExtra)
library(treemapify)
library(flextable)
library(officer)

# Set ggplot2 theme
theme_set(theme_minimal(base_size = 12))

# SATOM Brand Colors (from stm_brand.yml)
brand_colors <- c(
  primary = "#7093BF", # samue
  secondary = "#D3D3D2", # ginhakushoku
  success = "#97CEA1", # urahairo
  warning = "#F7B981", # akagai
  danger = "#CB6874", # gochiso
  dark = "#375A9D", # noren
  navy = "#323172" # gosuiro
)

# Custom color palette for charts (using brand colors)
cphi_colors <- unname(c(
  brand_colors["primary"],
  brand_colors["danger"],
  brand_colors["warning"],
  brand_colors["success"],
  brand_colors["dark"]
))


# Custom theme for consistency
theme_satom <- function() {
  theme_minimal(base_size = 12, base_family = "Noto Sans") +
    theme(
      plot.title = element_text(
        face = "bold",
        size = 18,
        family = "Alata",
        color = brand_colors["navy"]
      ),
      plot.subtitle = element_text(
        size = 12,
        color = brand_colors["dark"],
        margin = margin(b = 10)
      ),
      axis.title = element_text(
        size = 10,
        color = brand_colors["navy"]
      ),
      legend.title = element_text(
        face = "bold",
        family = "Alata",
        size = 10
      ),
      legend.position = "bottom",
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "white", color = NA),
      panel.background = element_rect(fill = "white", color = NA)
    )
}

# Set as default theme
theme_set(theme_satom())
```

# Overview {.sidebar}

::: card
### About

This dashboard provides comprehensive analysis of **CPHI Japan**, Asia's premier pharmaceutical exhibition.

**Coverage:** 2023-2025\
**Last Updated:** `r Sys.Date()`\
**Source:** Official CPHI Japan Reports

------------------------------------------------------------------------

### Key Highlights

ðŸ“Š **`r format(793, big.mark=",")`** Exhibitors (2025)\
ðŸ‘¥ **`r format(34128, big.mark=",")`** Visitors (2025)\
ðŸŒ **32** Countries Represented\
ðŸ“ˆ **+61.3%** Visitor Growth

------------------------------------------------------------------------

*Powered by* [**SATOM OÃœ**](https://satom.eu/)
:::

# Trends

## Row {height="25%"}

```{r load-data, include=FALSE}
# Load all datasets
cphi_main <- read_csv("data/cphi_japan_data.csv")
visitor_demo_2024 <- read_csv("data/cphi_2024_visitor_demographics.csv")
visitor_countries_2024 <- read_csv("data/cphi_2024_visitor_countries.csv")
exhibitor_data_2024 <- read_csv("data/cphi_2024_exhibitor_data.csv")
exhibitor_countries_2024 <- read_csv("data/cphi_2024_exhibitor_countries.csv")
business_categories_2024 <- read_csv("data/cphi_2024_business_categories.csv")
exhibitor_countries_2025 <- read_csv("data/cphi_2025_exhibitor_countries.csv")
pavilions <- read_csv("data/cphi_pavilions.csv")

# Calculate metrics
growth_exhibitors <- ((793 - 720) / 720) * 100
growth_visitors <- ((34128 - 21159) / 21159) * 100
```

###  {.value-box .primary-box}

<i class="bi bi-building"></i> **Exhibitors 2025**

`r format(793, big.mark=",")`

::: text-muted
+10.1% from 2024
:::

###  {.value-box .secondary-box}

<i class="bi bi-people"></i> **Visitors 2025**

`r format(34128, big.mark=",")`

::: text-muted
+61.3% from 2024
:::

###  {.value-box .tertiary-box}

<i class="bi bi-globe"></i> **Countries**

32

::: text-muted
Participating nations
:::

###  {.value-box .quaternary-box}

<i class="bi bi-graph-up-arrow"></i> **Growth Rate**

+61.3%

::: text-muted
Visitor increase YoY
:::

## Row {height="75%"}

### Column {width="50%"}

```{r exhibitor-trends}
#| title: "Exhibitor Growth Trajectory"

p1 <- cphi_main %>%
  ggplot(aes(x = factor(year), y = exhibitors, group = 1)) +
  geom_line(color = brand_colors["primary"], linewidth = 1.5) +
  geom_point(size = 5, color = brand_colors["primary"]) +
  geom_text(
    aes(label = format(exhibitors, big.mark = ",")),
    vjust = -1.2,
    size = 10,
    fontface = "bold",
    color = brand_colors["navy"]
  ) +
  labs(
    title = "",
    subtitle = "",
    x = "Year",
    y = "Number of Exhibitors"
  ) +
  scale_y_continuous(labels = comma, limits = c(0, 900)) +
  theme_satom()
p1
# ggplotly(p1, tooltip = c("x", "y")) %>%
#   layout(font = list(family = "Noto Sans")) %>%
#   style(textposition = "top") # Adjust trace number if needed
```

### Column {width="50%"}

```{r visitor-trends}
#| title: "Visitor Growth Trajectory"
p2 <- cphi_main %>%
  filter(!is.na(unique_visitors)) %>%
  ggplot(aes(x = factor(year), y = unique_visitors, group = 1)) +
  geom_line(color = brand_colors["danger"], linewidth = 1.5) +
  geom_point(size = 5, color = brand_colors["danger"]) +
  geom_text(
    aes(label = format(unique_visitors, big.mark = ",")),
    vjust = -1.2,
    size = 10,
    fontface = "bold",
    color = brand_colors["navy"]
  ) +
  labs(
    title = "",
    # subtitle = "Number of unique visitors by year",
    x = "Year",
    y = "Number of Unique Visitors"
  ) +
  scale_y_continuous(labels = comma, limits = c(0, 40000)) +
  theme_satom()
p2
# ggplotly(p2, tooltip = c("x", "y")) %>%
#   layout(font = list(family = "Noto Sans")) %>%
#   style(textposition = "top") # Adjust trace number if needed
```

# Geography

## Row {height="50%"}

### Column {width="50%"}

```{r exhibitor-geo-2025}
#| title: "Top 10 Exhibitor Countries (2025)"
#| out-width: "100%"
# Top 20 countries for 2025
top20_2025 <- exhibitor_countries_2025 %>%
  arrange(desc(exhibitors)) %>%
  head(10) %>%
  mutate(country = fct_reorder(country, exhibitors))
library(plotly)

# Simple approach - let plotly handle color assignment automatically
plot_ly(
  data = top20_2025,
  x = ~exhibitors,
  y = ~ reorder(country, exhibitors),
  type = "bar",
  orientation = "h",
  color = ~region,
  colors = unname(cphi_colors), # Remove names, use colors in order
  text = ~exhibitors,
  textposition = "outside",
  textfont = list(size = 14, color = brand_colors["navy"]),
  hovertext = ~ paste0(
    "<b>",
    country,
    "</b><br>",
    "Exhibitors: ",
    exhibitors,
    "<br>",
    "Region: ",
    region
  ),
  hoverinfo = "text"
) %>%
  layout(
    xaxis = list(
      title = "Number of Exhibitors",
      range = c(0, 350)
    ),
    yaxis = list(title = ""),
    legend = list(
      title = list(text = "Region"),
      orientation = "h",
      y = 1.15,
      x = 0.5,
      xanchor = "center"
    ),
    # height = 600,
    margin = list(l = 0, r = 0, t = 10, b = 0),
    font = list(family = "Noto Sans", size = 12)
  ) %>%
  config(displaylogo = FALSE)
```

### Column {width="50%"}

```{r regional-treemap}
#| title: "Regional Distribution (2025)"
# Calculate regional summary
regional_summary_2025 <- exhibitor_countries_2025 %>%
  group_by(region) %>%
  summarise(total = sum(exhibitors), .groups = "drop") %>%
  arrange(desc(total)) %>%
  mutate(
    percentage = (total / sum(total)) * 100,
    label = paste0(region, "\n", total, " (", round(percentage, 1), "%)")
  )

# Create treemap
plot_ly(
  data = regional_summary_2025,
  type = "treemap",
  labels = ~region,
  parents = "",
  values = ~total,
  text = ~ paste0(
    # region,
    # "<br>",
    total,
    " exhibitors<br>",
    round(percentage, 1),
    "%"
  ),
  textposition = "middle center",
  textfont = list(size = 16, color = "white", family = "Alata"),
  marker = list(
    colors = unname(cphi_colors),
    line = list(color = "white", width = 2)
  )
) %>%
  layout(
    margin = list(l = 0, r = 0, t = 0, b = 0),
    # height = 600,
    font = list(family = "Noto Sans")
  ) %>%
  config(displaylogo = FALSE)
```

## Row {height="50%"}

### Column {width="50%"}

```{r visitor-geo-2024}
#| title: "Top 15 Visitor Origin Countries (2024)"
# Visitor countries table
visitor_countries_2024 %>%
  arrange(rank) %>%
  select(Rank = rank, Country = country, Region = region) %>%
  flextable() %>%
  # Header styling
  bg(bg = brand_colors["primary"], part = "header") %>%
  color(color = "white", part = "header") %>%
  bold(part = "header") %>%
  # Body styling
  bg(i = ~ Rank <= 5, bg = "#E8F4F8") %>% # Highlight top 5
  color(i = ~ Rank <= 3, j = "Rank", color = brand_colors["primary"]) %>%
  bold(i = ~ Rank <= 3, j = "Rank") %>%
  # Region colors
  color(j = "Region", color = brand_colors["navy"]) %>%
  # Borders
  border_remove() %>%
  hline_top(
    border = fp_border(color = brand_colors["primary"], width = 2),
    part = "header"
  ) %>%
  hline_bottom(
    border = fp_border(color = brand_colors["primary"], width = 2),
    part = "header"
  ) %>%
  hline_bottom(
    border = fp_border(color = "grey70", width = 1),
    part = "body"
  ) %>%
  # Alignment
  align(align = "center", j = "Rank", part = "all") %>%
  align(align = "left", j = c("Country", "Region"), part = "all") %>%
  # Width
  width(j = "Rank", width = 0.8) %>%
  width(j = "Country", width = 2) %>%
  width(j = "Region", width = 1.5) %>%
  # Font
  font(fontname = "Noto Sans", part = "all") %>%
  fontsize(size = 11, part = "body") %>%
  fontsize(size = 12, part = "header")
# Title
# set_caption(caption = "Top 15 Visitor Origin Countries (2024)")
```

### Column {width="50%"}

```{r exhibitor-geo-2024}
#| title: "Top 15 Exhibitor Countries (2024)"
# Exhibitor countries table
exhibitor_countries_2024 %>%
  arrange(rank) %>%
  select(Rank = rank, Country = country, Region = region) %>%
  flextable() %>%
  bg(bg = brand_colors["primary"], part = "header") %>%
  color(color = "white", part = "header") %>%
  bold(part = "header") %>%
  bg(i = ~ Rank <= 5, bg = "#E8F4F8") %>%
  color(i = ~ Rank <= 3, j = "Rank", color = brand_colors["primary"]) %>%
  bold(i = ~ Rank <= 3, j = "Rank") %>%
  color(j = "Region", color = brand_colors["navy"]) %>%
  border_remove() %>%
  hline_top(
    border = fp_border(color = brand_colors["primary"], width = 2),
    part = "header"
  ) %>%
  hline_bottom(
    border = fp_border(color = brand_colors["primary"], width = 2),
    part = "header"
  ) %>%
  hline_bottom(
    border = fp_border(color = "grey70", width = 1),
    part = "body"
  ) %>%
  align(align = "center", j = "Rank", part = "all") %>%
  align(align = "left", j = c("Country", "Region"), part = "all") %>%
  width(j = "Rank", width = 0.8) %>%
  width(j = "Country", width = 2) %>%
  width(j = "Region", width = 1.5) %>%
  font(fontname = "Noto Sans", part = "all") %>%
  fontsize(size = 11, part = "body") %>%
  fontsize(size = 12, part = "header")
# set_caption(caption = "Top 15 Exhibitor Countries (2024)")

```

# Visitors

## Row {height="25%"}

###  {.value-box .primary-box}

<i class="bi bi-wallet2"></i> **Purchasing Power**

62%

::: text-muted
Visitors with authority
:::

###  {.value-box .secondary-box}

<i class="bi bi-emoji-smile"></i> **Satisfaction**

73%

::: text-muted
Positive experience
:::

###  {.value-box .tertiary-box}

<i class="bi bi-arrow-repeat"></i> **Return Intent**

78%

::: text-muted
Will attend again
:::

###  {.value-box .quaternary-box}

<i class="bi bi-star"></i> **NPS Score**

+35

::: text-muted
Net Promoter Score
:::

## Row {height="75%"}

### Column {width="50%"}

```{r visitor-job-positions}
#| title: "Visitor Job Positions (2024)"
job_positions <- visitor_demo_2024 %>%
  filter(category == "Job Position") %>%
  arrange(desc(percentage)) %>%
  mutate(subcategory = fct_reorder(subcategory, percentage))

p5 <- ggplot(job_positions, aes(x = percentage, y = subcategory)) +
  geom_col(fill = brand_colors["primary"]) +
  geom_text(
    aes(label = paste0(percentage, "%")),
    hjust = -0.2,
    size = 3.5,
    color = brand_colors["navy"]
  ) +
  labs(
    # title = "Visitor Job Positions (2024)",
    # subtitle = "Professional role distribution",
    x = "Percentage (%)",
    y = NULL
  ) +
  scale_x_continuous(limits = c(0, 26)) +
  theme_satom()

ggplotly(p5, tooltip = c("y", "x")) %>%
  layout(font = list(family = "Noto Sans"))

```

### Column {width="50%"}

```{r visitor-interests}
#| title: "Primary Areas of Interest (2024)"
interests <- visitor_demo_2024 %>%
  filter(category == "Primary Interest") %>%
  arrange(desc(percentage)) %>%
  mutate(subcategory = fct_reorder(subcategory, percentage))

ggplot(interests, aes(x = percentage, y = subcategory, fill = subcategory)) +
  geom_col(show.legend = FALSE) +
  geom_text(
    aes(label = paste0(percentage, "%")),
    hjust = -0.2,
    size = 4,
    color = brand_colors["navy"]
  ) +
  scale_fill_manual(values = colorRampPalette(cphi_colors)(6)) +
  labs(
    # title = "Primary Areas of Interest (2024)",
    # subtitle = "What brings visitors to CPHI Japan",
    x = "Percentage (%)",
    y = NULL
  ) +
  scale_x_continuous(limits = c(0, 42)) +
  theme_satom()
```

# Exhibitors

## Row {height="30%"}

###  {.value-box .primary-box}

<i class="bi bi-emoji-smile"></i> **Satisfaction**

81%

::: text-muted
Positive experience
:::

###  {.value-box .secondary-box}

<i class="bi bi-arrow-repeat"></i> **Return Intent**

84%

::: text-muted
Will exhibit again
:::

###  {.value-box .tertiary-box}

<i class="bi bi-globe-americas"></i> **International**

61%

::: text-muted
Foreign exhibitors
:::

###  {.value-box .quaternary-box}

<i class="bi bi-star"></i> **NPS Score**

+25

::: text-muted
Net Promoter Score
:::

## Row {height="70%"}

### Column {width="50%"}

```{r exhibitor-objectives}
#| title: "Key Exhibitor Objectives (2024)"

objectives <- exhibitor_data_2024 %>%
  filter(grepl("Objective", category)) %>%
  arrange(desc(percentage)) %>%
  mutate(subcategory = fct_reorder(subcategory, percentage))

ggplot(objectives, aes(x = percentage, y = subcategory)) +
  geom_col(fill = brand_colors["danger"]) +
  geom_text(
    aes(label = paste0(percentage, "%")),
    hjust = -0.2,
    size = 4,
    color = brand_colors["navy"]
  ) +
  labs(
    # title = "Key Exhibitor Objectives (2024)",
    # subtitle = "Why companies exhibit at CPHI Japan",
    x = "Percentage (%)",
    y = NULL
  ) +
  scale_x_continuous(limits = c(0, 70)) +
  theme_satom()
```

### Column {width="50%"}

```{r exhibitor-origin}
#| title: "Exhibitor Origin Distribution (2024)"
exhibitor_origin <- exhibitor_data_2024 %>%
  filter(category == "Exhibitor Origin") %>%
  mutate(label = paste0(subcategory, "\n", value, " (", percentage, "%)"))

plot_ly(
  exhibitor_origin,
  labels = ~subcategory,
  values = ~value,
  type = 'pie',
  textinfo = 'label+percent',
  textfont = list(family = "Noto Sans", size = 14),
  marker = list(
    colors = c(brand_colors["primary"], brand_colors["warning"]),
    line = list(color = 'white', width = 2)
  )
) %>%
  layout(
    # title = list(
    #   text = "Exhibitor Origin Distribution (2024)",
    #   font = list(family = "Alata", size = 16, color = brand_colors["navy"])
    # ),
    font = list(family = "Noto Sans"),
    showlegend = TRUE,
    legend = list(font = list(family = "Noto Sans"))
  )
```

# Data Tables

## Row

### Column {.tabset}

#### 2025 Exhibitor Countries

```{r table-2025-countries}
exhibitor_countries_2025 %>%
  arrange(desc(exhibitors)) %>%
  datatable(
    colnames = c("Country", "Exhibitors", "Region"),
    caption = "Complete Exhibitor List by Country (2025)",
    options = list(
      pageLength = 15,
      order = list(list(1, 'desc')),
      dom = 'frtip',
      initComplete = JS(
        "function(settings, json) {",
        "$(this.api().table().header()).css({'background-color': '#7093BF', 'color': '#fff'});",
        "}"
      )
    ),
    rownames = FALSE,
    class = 'cell-border stripe'
  ) %>%
  formatStyle(
    'exhibitors',
    background = styleColorBar(
      exhibitor_countries_2025$exhibitors,
      brand_colors["primary"]
    ),
    backgroundSize = '98% 88%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )
```

#### 2024 Visitor Demographics

```{r table-visitor-demo}
visitor_demo_2024 %>%
  filter(
    category %in% c("Job Position", "Primary Purpose", "Primary Interest")
  ) %>%
  select(category, subcategory, percentage) %>%
  datatable(
    colnames = c("Category", "Item", "Percentage (%)"),
    caption = "Visitor Demographics and Interests (2024)",
    options = list(
      pageLength = 15,
      dom = 'frtip',
      initComplete = JS(
        "function(settings, json) {",
        "$(this.api().table().header()).css({'background-color': '#7093BF', 'color': '#fff'});",
        "}"
      )
    ),
    rownames = FALSE,
    class = 'cell-border stripe'
  ) %>%
  formatStyle(
    'percentage',
    background = styleColorBar(
      c(0, max(visitor_demo_2024$percentage)),
      brand_colors["success"]
    ),
    backgroundSize = '98% 88%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )
```

#### Business Categories

```{r table-business-categories}
business_categories_2024 %>%
  arrange(desc(percentage)) %>%
  datatable(
    colnames = c("Business Category", "Percentage (%)"),
    caption = "Visitor Business Categories (2024)",
    options = list(
      pageLength = 15,
      dom = 'frtip',
      initComplete = JS(
        "function(settings, json) {",
        "$(this.api().table().header()).css({'background-color': '#7093BF', 'color': '#fff'});",
        "}"
      )
    ),
    rownames = FALSE,
    class = 'cell-border stripe'
  ) %>%
  formatStyle(
    'percentage',
    background = styleColorBar(
      business_categories_2024$percentage,
      brand_colors["warning"]
    ),
    backgroundSize = '98% 88%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )
```

#### National Pavilions

```{r table-pavilions}
pavilions %>%
  select(year, pavilion_name, organizing_body) %>%
  arrange(desc(year), pavilion_name) %>%
  datatable(
    colnames = c("Year", "Pavilion Name", "Organizing Body"),
    caption = "National and Industry Pavilions (2024-2025)",
    options = list(
      pageLength = 10,
      dom = 'frtip',
      order = list(list(0, 'desc')),
      initComplete = JS(
        "function(settings, json) {",
        "$(this.api().table().header()).css({'background-color': '#7093BF', 'color': '#fff'});",
        "}"
      )
    ),
    rownames = FALSE,
    class = 'cell-border stripe'
  )
```

# About {orientation="columns"}

## Column {width="60%"}

::: card
### **CPHI Japan**

-   **CPHI Japan Post Show Report 2024** (Primary source)
-   **CPHI Japan Official Website** ([Japanese](https://www.cphijapan.com) \| [English](https://www.cphi.com/japan))
-   **Informa Markets Publications**

------------------------------------------------------------------------

### **Next Event: CPHI Japan 2026**

**Dates:** April 21-23, 2026\
**Venue:** Tokyo Big Sight, East Halls 1-3\
**Expected:** 800+ exhibitors, 35,000+ visitors

------------------------------------------------------------------------
:::

## Column {width="50%"}

```{r tokyo-map}
#| title: "Exhibition Venue Location"

library(leaflet)

tokyo_bigsight <- data.frame(
  lat = 35.6298,
  lng = 139.7946,
  name = "Tokyo Big Sight"
)
leaflet(tokyo_bigsight, width = "100%", height = "100%") %>%
  addProviderTiles(providers$Esri.WorldStreetMap) %>%
  addMarkers(
    lng = ~lng,
    lat = ~lat,
    popup = ~ paste0(
      "<div style='text-align: center;'>",
      "<h4>",
      name,
      "</h4>",
      "<p>CPHI Japan Venue</p>",
      "</div>"
    )
  ) %>%
  setView(lng = 139.7946, lat = 35.6298, zoom = 15) %>%
  addMiniMap(
    toggleDisplay = TRUE,
    tiles = providers$Esri.WorldStreetMap
  )

```

*For questions or data requests, contact the event organizers.*